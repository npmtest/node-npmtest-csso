{"/home/travis/build/npmtest/node-npmtest-csso/test.js":"/* istanbul instrument in package npmtest_csso */\n/*jslint\n    bitwise: true,\n    browser: true,\n    maxerr: 8,\n    maxlen: 96,\n    node: true,\n    nomen: true,\n    regexp: true,\n    stupid: true\n*/\n(function () {\n    'use strict';\n    var local;\n\n\n\n    // run shared js-env code - pre-init\n    (function () {\n        // init local\n        local = {};\n        // init modeJs\n        local.modeJs = (function () {\n            try {\n                return typeof navigator.userAgent === 'string' &&\n                    typeof document.querySelector('body') === 'object' &&\n                    typeof XMLHttpRequest.prototype.open === 'function' &&\n                    'browser';\n            } catch (errorCaughtBrowser) {\n                return module.exports &&\n                    typeof process.versions.node === 'string' &&\n                    typeof require('http').createServer === 'function' &&\n                    'node';\n            }\n        }());\n        // init global\n        local.global = local.modeJs === 'browser'\n            ? window\n            : global;\n        switch (local.modeJs) {\n        // re-init local from window.local\n        case 'browser':\n            local = local.global.utility2.objectSetDefault(\n                local.global.utility2_rollup || local.global.local,\n                local.global.utility2\n            );\n            break;\n        // re-init local from example.js\n        case 'node':\n            local = (local.global.utility2_rollup || require('utility2'))\n                .requireExampleJsFromReadme();\n            break;\n        }\n        // export local\n        local.global.local = local;\n    }());\n\n\n\n    // run shared js-env code - function\n    (function () {\n        return;\n    }());\n    switch (local.modeJs) {\n\n\n\n    // run browser js-env code - function\n    case 'browser':\n        break;\n\n\n\n    // run node js-env code - function\n    case 'node':\n        break;\n    }\n\n\n\n    // run shared js-env code - post-init\n    (function () {\n        return;\n    }());\n    switch (local.modeJs) {\n\n\n\n    // run browser js-env code - post-init\n    case 'browser':\n        // run tests\n        local.nop(local.modeTest &&\n            document.querySelector('#testRunButton1') &&\n            document.querySelector('#testRunButton1').click());\n        break;\n\n\n\n    // run node js-env code - post-init\n    /* istanbul ignore next */\n    case 'node':\n        local.testCase_buildApidoc_default = local.testCase_buildApidoc_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test buildApidoc's default handling-behavior-behavior\n         */\n            options = { modulePathList: module.paths };\n            local.buildApidoc(options, onError);\n        };\n\n        local.testCase_buildApp_default = local.testCase_buildApp_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test buildApp's default handling-behavior-behavior\n         */\n            local.testCase_buildReadme_default(options, local.onErrorThrow);\n            local.testCase_buildLib_default(options, local.onErrorThrow);\n            local.testCase_buildTest_default(options, local.onErrorThrow);\n            local.testCase_buildCustomOrg_default(options, local.onErrorThrow);\n            options = [];\n            local.buildApp(options, onError);\n        };\n\n        local.testCase_buildCustomOrg_default = local.testCase_buildCustomOrg_default ||\n            function (options, onError) {\n            /*\n             * this function will test buildCustomOrg's default handling-behavior\n             */\n                options = {};\n                local.buildCustomOrg(options, onError);\n            };\n\n        local.testCase_buildLib_default = local.testCase_buildLib_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test buildLib's default handling-behavior\n         */\n            options = {};\n            local.buildLib(options, onError);\n        };\n\n        local.testCase_buildReadme_default = local.testCase_buildReadme_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test buildReadme's default handling-behavior-behavior\n         */\n            options = {};\n            local.buildReadme(options, onError);\n        };\n\n        local.testCase_buildTest_default = local.testCase_buildTest_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test buildTest's default handling-behavior\n         */\n            options = {};\n            local.buildTest(options, onError);\n        };\n\n        local.testCase_webpage_default = local.testCase_webpage_default || function (\n            options,\n            onError\n        ) {\n        /*\n         * this function will test webpage's default handling-behavior\n         */\n            options = { modeCoverageMerge: true, url: local.serverLocalHost + '?modeTest=1' };\n            local.browserTest(options, onError);\n        };\n\n        // run test-server\n        local.testRunServer(local);\n        break;\n    }\n}());\n","/home/travis/build/npmtest/node-npmtest-csso/lib.npmtest_csso.js":"/* istanbul instrument in package npmtest_csso */\n/*jslint\n    bitwise: true,\n    browser: true,\n    maxerr: 8,\n    maxlen: 96,\n    node: true,\n    nomen: true,\n    regexp: true,\n    stupid: true\n*/\n(function () {\n    'use strict';\n    var local;\n\n\n\n    // run shared js-env code - pre-init\n    (function () {\n        // init local\n        local = {};\n        // init modeJs\n        local.modeJs = (function () {\n            try {\n                return typeof navigator.userAgent === 'string' &&\n                    typeof document.querySelector('body') === 'object' &&\n                    typeof XMLHttpRequest.prototype.open === 'function' &&\n                    'browser';\n            } catch (errorCaughtBrowser) {\n                return module.exports &&\n                    typeof process.versions.node === 'string' &&\n                    typeof require('http').createServer === 'function' &&\n                    'node';\n            }\n        }());\n        // init global\n        local.global = local.modeJs === 'browser'\n            ? window\n            : global;\n        // init utility2_rollup\n        local = local.global.utility2_rollup || local;\n        // init lib\n        local.local = local.npmtest_csso = local;\n        // init exports\n        if (local.modeJs === 'browser') {\n            local.global.utility2_npmtest_csso = local;\n        } else {\n            module.exports = local;\n            module.exports.__dirname = __dirname;\n            module.exports.module = module;\n        }\n    }());\n}());\n","/home/travis/build/npmtest/node-npmtest-csso/example.js":"/*\nexample.js\n\nquickstart example\n\ninstruction\n    1. save this script as example.js\n    2. run the shell command:\n        $ npm install npmtest-csso && PORT=8081 node example.js\n    3. play with the browser-demo on http://127.0.0.1:8081\n*/\n\n\n\n/* istanbul instrument in package npmtest_csso */\n/*jslint\n    bitwise: true,\n    browser: true,\n    maxerr: 8,\n    maxlen: 96,\n    node: true,\n    nomen: true,\n    regexp: true,\n    stupid: true\n*/\n(function () {\n    'use strict';\n    var local;\n\n\n\n    // run shared js-env code - pre-init\n    (function () {\n        // init local\n        local = {};\n        // init modeJs\n        local.modeJs = (function () {\n            try {\n                return typeof navigator.userAgent === 'string' &&\n                    typeof document.querySelector('body') === 'object' &&\n                    typeof XMLHttpRequest.prototype.open === 'function' &&\n                    'browser';\n            } catch (errorCaughtBrowser) {\n                return module.exports &&\n                    typeof process.versions.node === 'string' &&\n                    typeof require('http').createServer === 'function' &&\n                    'node';\n            }\n        }());\n        // init global\n        local.global = local.modeJs === 'browser'\n            ? window\n            : global;\n        // init utility2_rollup\n        local = local.global.utility2_rollup || (local.modeJs === 'browser'\n            ? local.global.utility2_npmtest_csso\n            : global.utility2_moduleExports);\n        // export local\n        local.global.local = local;\n    }());\n    switch (local.modeJs) {\n\n\n\n    // post-init\n    // run browser js-env code - post-init\n    /* istanbul ignore next */\n    case 'browser':\n        local.testRunBrowser = function (event) {\n            if (!event || (event &&\n                    event.currentTarget &&\n                    event.currentTarget.className &&\n                    event.currentTarget.className.includes &&\n                    event.currentTarget.className.includes('onreset'))) {\n                // reset output\n                Array.from(\n                    document.querySelectorAll('body > .resettable')\n                ).forEach(function (element) {\n                    switch (element.tagName) {\n                    case 'INPUT':\n                    case 'TEXTAREA':\n                        element.value = '';\n                        break;\n                    default:\n                        element.textContent = '';\n                    }\n                });\n            }\n            switch (event && event.currentTarget && event.currentTarget.id) {\n            case 'testRunButton1':\n                // show tests\n                if (document.querySelector('#testReportDiv1').style.display === 'none') {\n                    document.querySelector('#testReportDiv1').style.display = 'block';\n                    document.querySelector('#testRunButton1').textContent =\n                        'hide internal test';\n                    local.modeTest = true;\n                    local.testRunDefault(local);\n                // hide tests\n                } else {\n                    document.querySelector('#testReportDiv1').style.display = 'none';\n                    document.querySelector('#testRunButton1').textContent = 'run internal test';\n                }\n                break;\n            // custom-case\n            default:\n                break;\n            }\n            if (document.querySelector('#inputTextareaEval1') && (!event || (event &&\n                    event.currentTarget &&\n                    event.currentTarget.className &&\n                    event.currentTarget.className.includes &&\n                    event.currentTarget.className.includes('oneval')))) {\n                // try to eval input-code\n                try {\n                    /*jslint evil: true*/\n                    eval(document.querySelector('#inputTextareaEval1').value);\n                } catch (errorCaught) {\n                    console.error(errorCaught.stack);\n                }\n            }\n        };\n        // log stderr and stdout to #outputTextareaStdout1\n        ['error', 'log'].forEach(function (key) {\n            console[key + '_original'] = console[key];\n            console[key] = function () {\n                var element;\n                console[key + '_original'].apply(console, arguments);\n                element = document.querySelector('#outputTextareaStdout1');\n                if (!element) {\n                    return;\n                }\n                // append text to #outputTextareaStdout1\n                element.value += Array.from(arguments).map(function (arg) {\n                    return typeof arg === 'string'\n                        ? arg\n                        : JSON.stringify(arg, null, 4);\n                }).join(' ') + '\\n';\n                // scroll textarea to bottom\n                element.scrollTop = element.scrollHeight;\n            };\n        });\n        // init event-handling\n        ['change', 'click', 'keyup'].forEach(function (event) {\n            Array.from(document.querySelectorAll('.on' + event)).forEach(function (element) {\n                element.addEventListener(event, local.testRunBrowser);\n            });\n        });\n        // run tests\n        local.testRunBrowser();\n        break;\n\n\n\n    // run node js-env code - post-init\n    /* istanbul ignore next */\n    case 'node':\n        // export local\n        module.exports = local;\n        // require modules\n        local.fs = require('fs');\n        local.http = require('http');\n        local.url = require('url');\n        // init assets\n        local.assetsDict = local.assetsDict || {};\n        /* jslint-ignore-begin */\n        local.assetsDict['/assets.index.template.html'] = '\\\n<!doctype html>\\n\\\n<html lang=\"en\">\\n\\\n<head>\\n\\\n<meta charset=\"UTF-8\">\\n\\\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\\n\\\n<title>{{env.npm_package_name}} (v{{env.npm_package_version}})</title>\\n\\\n<style>\\n\\\n/*csslint\\n\\\n    box-sizing: false,\\n\\\n    universal-selector: false\\n\\\n*/\\n\\\n* {\\n\\\n    box-sizing: border-box;\\n\\\n}\\n\\\nbody {\\n\\\n    background: #dde;\\n\\\n    font-family: Arial, Helvetica, sans-serif;\\n\\\n    margin: 2rem;\\n\\\n}\\n\\\nbody > * {\\n\\\n    margin-bottom: 1rem;\\n\\\n}\\n\\\n.utility2FooterDiv {\\n\\\n    margin-top: 20px;\\n\\\n    text-align: center;\\n\\\n}\\n\\\n</style>\\n\\\n<style>\\n\\\n/*csslint\\n\\\n*/\\n\\\ntextarea {\\n\\\n    font-family: monospace;\\n\\\n    height: 10rem;\\n\\\n    width: 100%;\\n\\\n}\\n\\\ntextarea[readonly] {\\n\\\n    background: #ddd;\\n\\\n}\\n\\\n</style>\\n\\\n</head>\\n\\\n<body>\\n\\\n<!-- utility2-comment\\n\\\n<div id=\"ajaxProgressDiv1\" style=\"background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 0.5s, width 1.5s; width: 25%;\"></div>\\n\\\nutility2-comment -->\\n\\\n<h1>\\n\\\n<!-- utility2-comment\\n\\\n    <a\\n\\\n        {{#if env.npm_package_homepage}}\\n\\\n        href=\"{{env.npm_package_homepage}}\"\\n\\\n        {{/if env.npm_package_homepage}}\\n\\\n        target=\"_blank\"\\n\\\n    >\\n\\\nutility2-comment -->\\n\\\n        {{env.npm_package_name}} (v{{env.npm_package_version}})\\n\\\n<!-- utility2-comment\\n\\\n    </a>\\n\\\nutility2-comment -->\\n\\\n</h1>\\n\\\n<h3>{{env.npm_package_description}}</h3>\\n\\\n<!-- utility2-comment\\n\\\n<h4><a download href=\"assets.app.js\">download standalone app</a></h4>\\n\\\n<button class=\"onclick onreset\" id=\"testRunButton1\">run internal test</button><br>\\n\\\n<div id=\"testReportDiv1\" style=\"display: none;\"></div>\\n\\\nutility2-comment -->\\n\\\n\\n\\\n\\n\\\n\\n\\\n<label>stderr and stdout</label>\\n\\\n<textarea class=\"resettable\" id=\"outputTextareaStdout1\" readonly></textarea>\\n\\\n<!-- utility2-comment\\n\\\n{{#if isRollup}}\\n\\\n<script src=\"assets.app.js\"></script>\\n\\\n{{#unless isRollup}}\\n\\\nutility2-comment -->\\n\\\n<script src=\"assets.utility2.rollup.js\"></script>\\n\\\n<script src=\"jsonp.utility2._stateInit?callback=window.utility2._stateInit\"></script>\\n\\\n<script src=\"assets.npmtest_csso.rollup.js\"></script>\\n\\\n<script src=\"assets.example.js\"></script>\\n\\\n<script src=\"assets.test.js\"></script>\\n\\\n<!-- utility2-comment\\n\\\n{{/if isRollup}}\\n\\\nutility2-comment -->\\n\\\n<div class=\"utility2FooterDiv\">\\n\\\n    [ this app was created with\\n\\\n    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\\n\\\n    ]\\n\\\n</div>\\n\\\n</body>\\n\\\n</html>\\n\\\n';\n        /* jslint-ignore-end */\n        if (local.templateRender) {\n            local.assetsDict['/'] = local.templateRender(\n                local.assetsDict['/assets.index.template.html'],\n                {\n                    env: local.objectSetDefault(local.env, {\n                        npm_package_description: 'the greatest app in the world!',\n                        npm_package_name: 'my-app',\n                        npm_package_nameAlias: 'my_app',\n                        npm_package_version: '0.0.1'\n                    })\n                }\n            );\n        } else {\n            local.assetsDict['/'] = local.assetsDict['/assets.index.template.html']\n                .replace((/\\{\\{env\\.(\\w+?)\\}\\}/g), function (match0, match1) {\n                    // jslint-hack\n                    String(match0);\n                    switch (match1) {\n                    case 'npm_package_description':\n                        return 'the greatest app in the world!';\n                    case 'npm_package_name':\n                        return 'my-app';\n                    case 'npm_package_nameAlias':\n                        return 'my_app';\n                    case 'npm_package_version':\n                        return '0.0.1';\n                    }\n                });\n        }\n        // run the cli\n        if (local.global.utility2_rollup || module !== require.main) {\n            break;\n        }\n        local.assetsDict['/assets.example.js'] =\n            local.assetsDict['/assets.example.js'] ||\n            local.fs.readFileSync(__filename, 'utf8');\n        local.assetsDict['/assets.npmtest_csso.rollup.js'] =\n            local.assetsDict['/assets.npmtest_csso.rollup.js'] ||\n            local.fs.readFileSync(\n                // buildCustomOrg-hack\n                local.npmtest_csso.__dirname +\n                    '/lib.npmtest_csso.js',\n                'utf8'\n            ).replace((/^#!/), '//');\n        local.assetsDict['/favicon.ico'] = local.assetsDict['/favicon.ico'] || '';\n        // if $npm_config_timeout_exit exists,\n        // then exit this process after $npm_config_timeout_exit ms\n        if (Number(process.env.npm_config_timeout_exit)) {\n            setTimeout(process.exit, Number(process.env.npm_config_timeout_exit));\n        }\n        // start server\n        if (local.global.utility2_serverHttp1) {\n            break;\n        }\n        process.env.PORT = process.env.PORT || '8081';\n        console.error('server starting on port ' + process.env.PORT);\n        local.http.createServer(function (request, response) {\n            request.urlParsed = local.url.parse(request.url);\n            if (local.assetsDict[request.urlParsed.pathname] !== undefined) {\n                response.end(local.assetsDict[request.urlParsed.pathname]);\n                return;\n            }\n            response.statusCode = 404;\n            response.end();\n        }).listen(process.env.PORT);\n        break;\n    }\n}());\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/index.js":"var csstree = require('css-tree');\nvar parse = csstree.parse;\nvar compress = require('./compress');\nvar translate = csstree.translate;\nvar translateWithSourceMap = csstree.translateWithSourceMap;\n\nfunction debugOutput(name, options, startTime, data) {\n    if (options.debug) {\n        console.error('## ' + name + ' done in %d ms\\n', Date.now() - startTime);\n    }\n\n    return data;\n}\n\nfunction createDefaultLogger(level) {\n    var lastDebug;\n\n    return function logger(title, ast) {\n        var line = title;\n\n        if (ast) {\n            line = '[' + ((Date.now() - lastDebug) / 1000).toFixed(3) + 's] ' + line;\n        }\n\n        if (level > 1 && ast) {\n            var css = translate(ast, true);\n\n            // when level 2, limit css to 256 symbols\n            if (level === 2 && css.length > 256) {\n                css = css.substr(0, 256) + '...';\n            }\n\n            line += '\\n  ' + css + '\\n';\n        }\n\n        console.error(line);\n        lastDebug = Date.now();\n    };\n}\n\nfunction copy(obj) {\n    var result = {};\n\n    for (var key in obj) {\n        result[key] = obj[key];\n    }\n\n    return result;\n}\n\nfunction buildCompressOptions(options) {\n    options = copy(options);\n\n    if (typeof options.logger !== 'function' && options.debug) {\n        options.logger = createDefaultLogger(options.debug);\n    }\n\n    return options;\n}\n\nfunction runHandler(ast, options, handlers) {\n    if (!Array.isArray(handlers)) {\n        handlers = [handlers];\n    }\n\n    handlers.forEach(function(fn) {\n        fn(ast, options);\n    });\n}\n\nfunction minify(context, source, options) {\n    options = options || {};\n\n    var filename = options.filename || '<unknown>';\n    var result;\n\n    // parse\n    var ast = debugOutput('parsing', options, Date.now(),\n        parse(source, {\n            context: context,\n            filename: filename,\n            positions: Boolean(options.sourceMap)\n        })\n    );\n\n    // before compress handlers\n    if (options.beforeCompress) {\n        debugOutput('beforeCompress', options, Date.now(),\n            runHandler(ast, options, options.beforeCompress)\n        );\n    }\n\n    // compress\n    var compressResult = debugOutput('compress', options, Date.now(),\n        compress(ast, buildCompressOptions(options))\n    );\n\n    // after compress handlers\n    if (options.afterCompress) {\n        debugOutput('afterCompress', options, Date.now(),\n            runHandler(compressResult, options, options.afterCompress)\n        );\n    }\n\n    // translate\n    if (options.sourceMap) {\n        result = debugOutput('translateWithSourceMap', options, Date.now(), (function() {\n            var tmp = translateWithSourceMap(compressResult.ast);\n            tmp.map._file = filename; // since other tools can relay on file in source map transform chain\n            tmp.map.setSourceContent(filename, source);\n            return tmp;\n        })());\n    } else {\n        result = debugOutput('translate', options, Date.now(), {\n            css: translate(compressResult.ast),\n            map: null\n        });\n    }\n\n    return result;\n}\n\nfunction minifyStylesheet(source, options) {\n    return minify('stylesheet', source, options);\n};\n\nfunction minifyBlock(source, options) {\n    return minify('declarationList', source, options);\n}\n\nmodule.exports = {\n    version: require('../package.json').version,\n\n    // main methods\n    minify: minifyStylesheet,\n    minifyBlock: minifyBlock,\n\n    // compress an AST\n    compress: compress,\n\n    // css syntax parser/walkers/generator/etc\n    syntax: csstree\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/compress.js":"var List = require('css-tree').List;\nvar clone = require('css-tree').clone;\nvar usageUtils = require('./usage');\nvar clean = require('./clean');\nvar replace = require('./replace');\nvar restructureBlock = require('./restructure');\nvar walkRules = require('css-tree').walkRules;\n\nfunction readChunk(children, specialComments) {\n    var buffer = new List();\n    var nonSpaceTokenInBuffer = false;\n    var protectedComment;\n\n    children.nextUntil(children.head, function(node, item, list) {\n        if (node.type === 'Comment') {\n            if (!specialComments || node.value.charAt(0) !== '!') {\n                list.remove(item);\n                return;\n            }\n\n            if (nonSpaceTokenInBuffer || protectedComment) {\n                return true;\n            }\n\n            list.remove(item);\n            protectedComment = node;\n            return;\n        }\n\n        if (node.type !== 'WhiteSpace') {\n            nonSpaceTokenInBuffer = true;\n        }\n\n        buffer.insert(list.remove(item));\n    });\n\n    return {\n        comment: protectedComment,\n        stylesheet: {\n            type: 'StyleSheet',\n            loc: null,\n            children: buffer\n        }\n    };\n}\n\nfunction compressChunk(ast, firstAtrulesAllowed, usageData, num, logger) {\n    logger('Compress block #' + num, null, true);\n\n    var seed = 1;\n\n    if (ast.type === 'StyleSheet') {\n        ast.firstAtrulesAllowed = firstAtrulesAllowed;\n        ast.id = seed++;\n    }\n\n    walkRules(ast, function markScopes(node) {\n        if (node.type === 'Atrule' && node.block !== null) {\n            node.block.id = seed++;\n        }\n    });\n    logger('init', ast);\n\n    // remove redundant\n    clean(ast, usageData);\n    logger('clean', ast);\n\n    // replace nodes for shortened forms\n    replace(ast, usageData);\n    logger('replace', ast);\n\n    return ast;\n}\n\nfunction getCommentsOption(options) {\n    var comments = 'comments' in options ? options.comments : 'exclamation';\n\n    if (typeof comments === 'boolean') {\n        comments = comments ? 'exclamation' : false;\n    } else if (comments !== 'exclamation' && comments !== 'first-exclamation') {\n        comments = false;\n    }\n\n    return comments;\n}\n\nfunction getRestructureOption(options) {\n    return 'restructure' in options ? options.restructure :\n           'restructuring' in options ? options.restructuring :\n           true;\n}\n\nfunction wrapBlock(block) {\n    return new List().appendData({\n        type: 'Rule',\n        selector: {\n            type: 'SelectorList',\n            children: new List().appendData({\n                type: 'Selector',\n                children: new List().appendData({\n                    type: 'Identifier',\n                    name: 'x'\n                })\n            })\n        },\n        block: block\n    });\n}\n\nmodule.exports = function compress(ast, options) {\n    ast = ast || { type: 'StyleSheet', loc: null, children: new List() };\n    options = options || {};\n\n    var logger = typeof options.logger === 'function' ? options.logger : function() {};\n    var specialComments = getCommentsOption(options);\n    var restructuring = getRestructureOption(options);\n    var firstAtrulesAllowed = true;\n    var usageData = false;\n    var inputRules;\n    var outputRules = new List();\n    var chunk;\n    var chunkNum = 1;\n    var chunkRules;\n\n    if (options.clone) {\n        ast = clone(ast);\n    }\n\n    if (ast.type === 'StyleSheet') {\n        inputRules = ast.children;\n        ast.children = outputRules;\n    } else {\n        inputRules = wrapBlock(ast);\n    }\n\n    if (options.usage) {\n        usageData = usageUtils.buildIndex(options.usage);\n    }\n\n    do {\n        chunk = readChunk(inputRules, Boolean(specialComments));\n\n        compressChunk(chunk.stylesheet, firstAtrulesAllowed, usageData, chunkNum++, logger);\n\n        // structure optimisations\n        if (restructuring) {\n            restructureBlock(chunk.stylesheet, usageData, logger);\n        }\n\n        chunkRules = chunk.stylesheet.children;\n\n        if (chunk.comment) {\n            // add \\n before comment if there is another content in outputRules\n            if (!outputRules.isEmpty()) {\n                outputRules.insert(List.createItem({\n                    type: 'Raw',\n                    value: '\\n'\n                }));\n            }\n\n            outputRules.insert(List.createItem(chunk.comment));\n\n            // add \\n after comment if chunk is not empty\n            if (!chunkRules.isEmpty()) {\n                outputRules.insert(List.createItem({\n                    type: 'Raw',\n                    value: '\\n'\n                }));\n            }\n        }\n\n        if (firstAtrulesAllowed && !chunkRules.isEmpty()) {\n            var lastRule = chunkRules.last();\n\n            if (lastRule.type !== 'Atrule' ||\n               (lastRule.name !== 'import' && lastRule.name !== 'charset')) {\n                firstAtrulesAllowed = false;\n            }\n        }\n\n        if (specialComments !== 'exclamation') {\n            specialComments = false;\n        }\n\n        outputRules.appendList(chunkRules);\n    } while (!inputRules.isEmpty());\n\n    return {\n        ast: ast\n    };\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/usage.js":"var hasOwnProperty = Object.prototype.hasOwnProperty;\n\nfunction buildMap(list, caseInsensitive) {\n    var map = Object.create(null);\n\n    if (!Array.isArray(list)) {\n        return false;\n    }\n\n    for (var i = 0; i < list.length; i++) {\n        var name = list[i];\n\n        if (caseInsensitive) {\n            name = name.toLowerCase();\n        }\n\n        map[name] = true;\n    }\n\n    return map;\n}\n\nfunction buildIndex(data) {\n    var scopes = false;\n\n    if (data.scopes && Array.isArray(data.scopes)) {\n        scopes = Object.create(null);\n\n        for (var i = 0; i < data.scopes.length; i++) {\n            var list = data.scopes[i];\n\n            if (!list || !Array.isArray(list)) {\n                throw new Error('Wrong usage format');\n            }\n\n            for (var j = 0; j < list.length; j++) {\n                var name = list[j];\n\n                if (hasOwnProperty.call(scopes, name)) {\n                    throw new Error('Class can\\'t be used for several scopes: ' + name);\n                }\n\n                scopes[name] = i + 1;\n            }\n        }\n    }\n\n    return {\n        tags: buildMap(data.tags, true),\n        ids: buildMap(data.ids),\n        classes: buildMap(data.classes),\n        scopes: scopes\n    };\n}\n\nmodule.exports = {\n    buildIndex: buildIndex\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/clean/index.js":"var walk = require('css-tree').walkUp;\nvar handlers = {\n    Atrule: require('./Atrule'),\n    Rule: require('./Rule'),\n    Declaration: require('./Declaration'),\n    TypeSelector: require('./TypeSelector'),\n    Comment: require('./Comment'),\n    Operator: require('./WhiteSpace')\n};\n\nmodule.exports = function(ast, usageData) {\n    walk(ast, function(node, item, list) {\n        if (handlers.hasOwnProperty(node.type)) {\n            handlers[node.type].call(this, node, item, list, usageData);\n        }\n    });\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/clean/Atrule.js":"module.exports = function cleanAtrule(node, item, list) {\n    if (node.block) {\n        // otherwise removed at-rule don't prevent @import for removal\n        if (this.stylesheet !== null) {\n            this.stylesheet.firstAtrulesAllowed = false;\n        }\n\n        if (node.block.children.isEmpty()) {\n            list.remove(item);\n            return;\n        }\n    }\n\n    switch (node.name) {\n        case 'charset':\n            if (!node.expression || node.expression.children.isEmpty()) {\n                list.remove(item);\n                return;\n            }\n\n            // if there is any rule before @charset -> remove it\n            if (item.prev) {\n                list.remove(item);\n                return;\n            }\n\n            break;\n\n        case 'import':\n            if (this.stylesheet === null || !this.stylesheet.firstAtrulesAllowed) {\n                list.remove(item);\n                return;\n            }\n\n            // if there are some rules that not an @import or @charset before @import\n            // remove it\n            list.prevUntil(item.prev, function(rule) {\n                if (rule.type === 'Atrule') {\n                    if (rule.name === 'import' || rule.name === 'charset') {\n                        return;\n                    }\n                }\n\n                this.root.firstAtrulesAllowed = false;\n                list.remove(item);\n                return true;\n            }, this);\n\n            break;\n    }\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/clean/Rule.js":"var hasOwnProperty = Object.prototype.hasOwnProperty;\n\nfunction cleanUnused(node, usageData) {\n    return node.selector.children.each(function(selector, item, list) {\n        var hasUnused = selector.children.some(function(node) {\n            switch (node.type) {\n                case 'ClassSelector':\n                    return usageData.classes && !hasOwnProperty.call(usageData.classes, node.name);\n\n                case 'IdSelector':\n                    return usageData.ids && !hasOwnProperty.call(usageData.ids, node.name);\n\n                case 'TypeSelector':\n                    // TODO: remove toLowerCase when type selectors will be normalized\n                    // ignore universal selectors\n                    if (node.name.charAt(node.name.length - 1) !== '*') {\n                        return usageData.tags && !hasOwnProperty.call(usageData.tags, node.name.toLowerCase());\n                    }\n            }\n        });\n\n        if (hasUnused) {\n            list.remove(item);\n        }\n    });\n}\n\nmodule.exports = function cleanRuleset(node, item, list, usageData) {\n    if (usageData) {\n        cleanUnused(node, usageData);\n    }\n\n    if (node.selector.children.isEmpty() ||\n        node.block.children.isEmpty()) {\n        list.remove(item);\n    }\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/clean/Declaration.js":"module.exports = function cleanDeclartion(node, item, list) {\n    if (node.value.children && node.value.children.isEmpty()) {\n        list.remove(item);\n    }\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/clean/TypeSelector.js":"// remove useless universal selector\nmodule.exports = function cleanType(node, item, list) {\n    var name = item.data.name;\n\n    // check it's a non-namespaced universal selector\n    if (name !== '*') {\n        return;\n    }\n\n    // remove when universal selector before other selectors\n    var nextType = item.next && item.next.data.type;\n    if (nextType === 'IdSelector' ||\n        nextType === 'ClassSelector' ||\n        nextType === 'AttributeSelector' ||\n        nextType === 'PseudoClassSelector' ||\n        nextType === 'PseudoElementSelector') {\n        list.remove(item);\n    }\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/clean/Comment.js":"module.exports = function cleanComment(data, item, list) {\n    list.remove(item);\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/clean/WhiteSpace.js":"module.exports = function cleanWhitespace(node, item, list) {\n    if (node.value === '+' || node.value === '-') {\n        return;\n    }\n\n    if (item.prev !== null && item.prev.data.type === 'WhiteSpace') {\n        list.remove(item.prev);\n    }\n\n    if (item.next !== null && item.next.data.type === 'WhiteSpace') {\n        list.remove(item.next);\n    }\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/replace/index.js":"var walk = require('css-tree').walkUp;\nvar handlers = {\n    Atrule: require('./Atrule'),\n    AttributeSelector: require('./AttributeSelector'),\n    Value: require('./Value'),\n    Dimension: require('./Dimension'),\n    Percentage: require('./Number'),\n    Number: require('./Number'),\n    String: require('./String'),\n    Url: require('./Url'),\n    HexColor: require('./color').compressHex,\n    Identifier: require('./color').compressIdent,\n    Function: require('./color').compressFunction\n};\n\nmodule.exports = function(ast) {\n    walk(ast, function(node, item, list) {\n        if (handlers.hasOwnProperty(node.type)) {\n            handlers[node.type].call(this, node, item, list);\n        }\n    });\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/replace/Atrule.js":"var resolveKeyword = require('css-tree').keyword;\nvar compressKeyframes = require('./atrule/keyframes.js');\n\nmodule.exports = function(node) {\n    // compress @keyframe selectors\n    if (resolveKeyword(node.name).name === 'keyframes') {\n        compressKeyframes(node);\n    }\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/replace/atrule/keyframes.js":"module.exports = function(node) {\n    node.block.children.each(function(rule) {\n        rule.selector.children.each(function(simpleselector) {\n            simpleselector.children.each(function(data, item) {\n                if (data.type === 'Percentage' && data.value === '100') {\n                    item.data = {\n                        type: 'TypeSelector',\n                        loc: data.loc,\n                        name: 'to'\n                    };\n                } else if (data.type === 'TypeSelector' && data.name === 'from') {\n                    item.data = {\n                        type: 'Percentage',\n                        loc: data.loc,\n                        value: '0'\n                    };\n                }\n            });\n        });\n    });\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/replace/AttributeSelector.js":"// Can unquote attribute detection\n// Adopted implementation of Mathias Bynens\n// https://github.com/mathiasbynens/mothereff.in/blob/master/unquoted-attributes/eff.js\nvar escapesRx = /\\\\([0-9A-Fa-f]{1,6})(\\r\\n|[ \\t\\n\\f\\r])?|\\\\./g;\nvar blockUnquoteRx = /^(-?\\d|--)|[\\u0000-\\u002c\\u002e\\u002f\\u003A-\\u0040\\u005B-\\u005E\\u0060\\u007B-\\u009f]/;\n\nfunction canUnquote(value) {\n    if (value === '' || value === '-') {\n        return;\n    }\n\n    // Escapes are valid, so replace them with a valid non-empty string\n    value = value.replace(escapesRx, 'a');\n\n    return !blockUnquoteRx.test(value);\n}\n\nmodule.exports = function(node) {\n    var attrValue = node.value;\n\n    if (!attrValue || attrValue.type !== 'String') {\n        return;\n    }\n\n    var unquotedValue = attrValue.value.replace(/^(.)(.*)\\1$/, '$2');\n    if (canUnquote(unquotedValue)) {\n        node.value = {\n            type: 'Identifier',\n            loc: attrValue.loc,\n            name: unquotedValue\n        };\n    }\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/replace/Value.js":"var resolveName = require('css-tree').property;\nvar handlers = {\n    'font': require('./property/font.js'),\n    'font-weight': require('./property/font-weight.js'),\n    'background': require('./property/background.js')\n};\n\nmodule.exports = function compressValue(node) {\n    if (!this.declaration) {\n        return;\n    }\n\n    var property = resolveName(this.declaration.property);\n\n    if (handlers.hasOwnProperty(property.name)) {\n        handlers[property.name](node);\n    }\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/replace/property/font.js":"module.exports = function compressFont(node) {\n    var list = node.children;\n\n    list.eachRight(function(node, item) {\n        if (node.type === 'Identifier') {\n            if (node.name === 'bold') {\n                item.data = {\n                    type: 'Number',\n                    loc: node.loc,\n                    value: '700'\n                };\n            } else if (node.name === 'normal') {\n                var prev = item.prev;\n\n                if (prev && prev.data.type === 'Operator' && prev.data.value === '/') {\n                    this.remove(prev);\n                }\n\n                this.remove(item);\n            } else if (node.name === 'medium') {\n                var next = item.next;\n\n                if (!next || next.data.type !== 'Operator') {\n                    this.remove(item);\n                }\n            }\n        }\n    });\n\n    // remove redundant spaces\n    list.each(function(node, item) {\n        if (node.type === 'WhiteSpace') {\n            if (!item.prev || !item.next || item.next.data.type === 'WhiteSpace') {\n                this.remove(item);\n            }\n        }\n    });\n\n    if (list.isEmpty()) {\n        list.insert(list.createItem({\n            type: 'Identifier',\n            name: 'normal'\n        }));\n    }\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/replace/property/font-weight.js":"module.exports = function compressFontWeight(node) {\n    var value = node.children.head.data;\n\n    if (value.type === 'Identifier') {\n        switch (value.name) {\n            case 'normal':\n                node.children.head.data = {\n                    type: 'Number',\n                    loc: value.loc,\n                    value: '400'\n                };\n                break;\n            case 'bold':\n                node.children.head.data = {\n                    type: 'Number',\n                    loc: value.loc,\n                    value: '700'\n                };\n                break;\n        }\n    }\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/replace/property/background.js":"var List = require('css-tree').List;\n\nmodule.exports = function compressBackground(node) {\n    function lastType() {\n        if (buffer.length) {\n            return buffer[buffer.length - 1].type;\n        }\n    }\n\n    function flush() {\n        if (lastType() === 'WhiteSpace') {\n            buffer.pop();\n        }\n\n        if (!buffer.length) {\n            buffer.unshift(\n                {\n                    type: 'Number',\n                    loc: null,\n                    value: '0'\n                },\n                {\n                    type: 'WhiteSpace',\n                    value: ' '\n                },\n                {\n                    type: 'Number',\n                    loc: null,\n                    value: '0'\n                }\n            );\n        }\n\n        newValue.push.apply(newValue, buffer);\n\n        buffer = [];\n    }\n\n    var newValue = [];\n    var buffer = [];\n\n    node.children.each(function(node) {\n        if (node.type === 'Operator' && node.value === ',') {\n            flush();\n            newValue.push(node);\n            return;\n        }\n\n        // remove defaults\n        if (node.type === 'Identifier') {\n            if (node.name === 'transparent' ||\n                node.name === 'none' ||\n                node.name === 'repeat' ||\n                node.name === 'scroll') {\n                return;\n            }\n        }\n\n        // don't add redundant spaces\n        if (node.type === 'WhiteSpace' && (!buffer.length || lastType() === 'WhiteSpace')) {\n            return;\n        }\n\n        buffer.push(node);\n    });\n\n    flush();\n    node.children = new List().fromArray(newValue);\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/replace/Dimension.js":"var packNumber = require('./Number.js').pack;\nvar LENGTH_UNIT = {\n    // absolute length units\n    'px': true,\n    'mm': true,\n    'cm': true,\n    'in': true,\n    'pt': true,\n    'pc': true,\n\n    // relative length units\n    'em': true,\n    'ex': true,\n    'ch': true,\n    'rem': true,\n\n    // viewport-percentage lengths\n    'vh': true,\n    'vw': true,\n    'vmin': true,\n    'vmax': true,\n    'vm': true\n};\n\nmodule.exports = function compressDimension(node, item) {\n    var value = packNumber(node.value);\n\n    node.value = value;\n\n    if (value === '0' && this.declaration !== null && this.atruleExpression === null) {\n        var unit = node.unit.toLowerCase();\n\n        // only length values can be compressed\n        if (!LENGTH_UNIT.hasOwnProperty(unit)) {\n            return;\n        }\n\n        // issue #200: don't remove units in flex property as it could change value meaning\n        if (this.declaration.property === 'flex') {\n            return;\n        }\n\n        // issue #222: don't remove units inside calc\n        if (this['function'] && this['function'].name === 'calc') {\n            return;\n        }\n\n        item.data = {\n            type: 'Number',\n            loc: node.loc,\n            value: value\n        };\n    }\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/replace/Number.js":"function packNumber(value) {\n    // 100 -> '100'\n    // 00100 -> '100'\n    // +100 -> '100'\n    // -100 -> '-100'\n    // 0.123 -> '.123'\n    // 0.12300 -> '.123'\n    // 0.0 -> ''\n    // 0 -> ''\n    value = String(value).replace(/^(?:\\+|(-))?0*(\\d*)(?:\\.0*|(\\.\\d*?)0*)?$/, '$1$2$3');\n\n    if (value.length === 0 || value === '-') {\n        value = '0';\n    }\n\n    return value;\n};\n\nmodule.exports = function(node) {\n    node.value = packNumber(node.value);\n};\nmodule.exports.pack = packNumber;\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/replace/String.js":"module.exports = function(node) {\n    var value = node.value;\n\n    // remove escaped newlines, i.e.\n    // .a { content: \"foo\\\n    // bar\"}\n    // ->\n    // .a { content: \"foobar\" }\n    value = value.replace(/\\\\(\\r\\n|\\r|\\n|\\f)/g, '');\n\n    node.value = value;\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/replace/Url.js":"var UNICODE = '\\\\\\\\[0-9a-f]{1,6}(\\\\r\\\\n|[ \\\\n\\\\r\\\\t\\\\f])?';\nvar ESCAPE = '(' + UNICODE + '|\\\\\\\\[^\\\\n\\\\r\\\\f0-9a-fA-F])';\nvar NONPRINTABLE = '\\u0000\\u0008\\u000b\\u000e-\\u001f\\u007f';\nvar SAFE_URL = new RegExp('^(' + ESCAPE + '|[^\\\"\\'\\\\(\\\\)\\\\\\\\\\\\s' + NONPRINTABLE + '])*$', 'i');\n\nmodule.exports = function(node) {\n    var value = node.value;\n\n    if (value.type !== 'String') {\n        return;\n    }\n\n    var quote = value.value[0];\n    var url = value.value.substr(1, value.value.length - 2);\n\n    // convert `\\\\` to `/`\n    url = url.replace(/\\\\\\\\/g, '/');\n\n    // remove quotes when safe\n    // https://www.w3.org/TR/css-syntax-3/#url-unquoted-diagram\n    if (SAFE_URL.test(url)) {\n        node.value = {\n            type: 'Raw',\n            loc: node.value.loc,\n            value: url\n        };\n    } else {\n        // use double quotes if string has no double quotes\n        // otherwise use original quotes\n        // TODO: make better quote type selection\n        node.value.value = url.indexOf('\"') === -1 ? '\"' + url + '\"' : quote + url + quote;\n    }\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/replace/color.js":"var packNumber = require('./Number.js').pack;\n\n// http://www.w3.org/TR/css3-color/#svg-color\nvar NAME_TO_HEX = {\n    'aliceblue': 'f0f8ff',\n    'antiquewhite': 'faebd7',\n    'aqua': '0ff',\n    'aquamarine': '7fffd4',\n    'azure': 'f0ffff',\n    'beige': 'f5f5dc',\n    'bisque': 'ffe4c4',\n    'black': '000',\n    'blanchedalmond': 'ffebcd',\n    'blue': '00f',\n    'blueviolet': '8a2be2',\n    'brown': 'a52a2a',\n    'burlywood': 'deb887',\n    'cadetblue': '5f9ea0',\n    'chartreuse': '7fff00',\n    'chocolate': 'd2691e',\n    'coral': 'ff7f50',\n    'cornflowerblue': '6495ed',\n    'cornsilk': 'fff8dc',\n    'crimson': 'dc143c',\n    'cyan': '0ff',\n    'darkblue': '00008b',\n    'darkcyan': '008b8b',\n    'darkgoldenrod': 'b8860b',\n    'darkgray': 'a9a9a9',\n    'darkgrey': 'a9a9a9',\n    'darkgreen': '006400',\n    'darkkhaki': 'bdb76b',\n    'darkmagenta': '8b008b',\n    'darkolivegreen': '556b2f',\n    'darkorange': 'ff8c00',\n    'darkorchid': '9932cc',\n    'darkred': '8b0000',\n    'darksalmon': 'e9967a',\n    'darkseagreen': '8fbc8f',\n    'darkslateblue': '483d8b',\n    'darkslategray': '2f4f4f',\n    'darkslategrey': '2f4f4f',\n    'darkturquoise': '00ced1',\n    'darkviolet': '9400d3',\n    'deeppink': 'ff1493',\n    'deepskyblue': '00bfff',\n    'dimgray': '696969',\n    'dimgrey': '696969',\n    'dodgerblue': '1e90ff',\n    'firebrick': 'b22222',\n    'floralwhite': 'fffaf0',\n    'forestgreen': '228b22',\n    'fuchsia': 'f0f',\n    'gainsboro': 'dcdcdc',\n    'ghostwhite': 'f8f8ff',\n    'gold': 'ffd700',\n    'goldenrod': 'daa520',\n    'gray': '808080',\n    'grey': '808080',\n    'green': '008000',\n    'greenyellow': 'adff2f',\n    'honeydew': 'f0fff0',\n    'hotpink': 'ff69b4',\n    'indianred': 'cd5c5c',\n    'indigo': '4b0082',\n    'ivory': 'fffff0',\n    'khaki': 'f0e68c',\n    'lavender': 'e6e6fa',\n    'lavenderblush': 'fff0f5',\n    'lawngreen': '7cfc00',\n    'lemonchiffon': 'fffacd',\n    'lightblue': 'add8e6',\n    'lightcoral': 'f08080',\n    'lightcyan': 'e0ffff',\n    'lightgoldenrodyellow': 'fafad2',\n    'lightgray': 'd3d3d3',\n    'lightgrey': 'd3d3d3',\n    'lightgreen': '90ee90',\n    'lightpink': 'ffb6c1',\n    'lightsalmon': 'ffa07a',\n    'lightseagreen': '20b2aa',\n    'lightskyblue': '87cefa',\n    'lightslategray': '789',\n    'lightslategrey': '789',\n    'lightsteelblue': 'b0c4de',\n    'lightyellow': 'ffffe0',\n    'lime': '0f0',\n    'limegreen': '32cd32',\n    'linen': 'faf0e6',\n    'magenta': 'f0f',\n    'maroon': '800000',\n    'mediumaquamarine': '66cdaa',\n    'mediumblue': '0000cd',\n    'mediumorchid': 'ba55d3',\n    'mediumpurple': '9370db',\n    'mediumseagreen': '3cb371',\n    'mediumslateblue': '7b68ee',\n    'mediumspringgreen': '00fa9a',\n    'mediumturquoise': '48d1cc',\n    'mediumvioletred': 'c71585',\n    'midnightblue': '191970',\n    'mintcream': 'f5fffa',\n    'mistyrose': 'ffe4e1',\n    'moccasin': 'ffe4b5',\n    'navajowhite': 'ffdead',\n    'navy': '000080',\n    'oldlace': 'fdf5e6',\n    'olive': '808000',\n    'olivedrab': '6b8e23',\n    'orange': 'ffa500',\n    'orangered': 'ff4500',\n    'orchid': 'da70d6',\n    'palegoldenrod': 'eee8aa',\n    'palegreen': '98fb98',\n    'paleturquoise': 'afeeee',\n    'palevioletred': 'db7093',\n    'papayawhip': 'ffefd5',\n    'peachpuff': 'ffdab9',\n    'peru': 'cd853f',\n    'pink': 'ffc0cb',\n    'plum': 'dda0dd',\n    'powderblue': 'b0e0e6',\n    'purple': '800080',\n    'rebeccapurple': '639',\n    'red': 'f00',\n    'rosybrown': 'bc8f8f',\n    'royalblue': '4169e1',\n    'saddlebrown': '8b4513',\n    'salmon': 'fa8072',\n    'sandybrown': 'f4a460',\n    'seagreen': '2e8b57',\n    'seashell': 'fff5ee',\n    'sienna': 'a0522d',\n    'silver': 'c0c0c0',\n    'skyblue': '87ceeb',\n    'slateblue': '6a5acd',\n    'slategray': '708090',\n    'slategrey': '708090',\n    'snow': 'fffafa',\n    'springgreen': '00ff7f',\n    'steelblue': '4682b4',\n    'tan': 'd2b48c',\n    'teal': '008080',\n    'thistle': 'd8bfd8',\n    'tomato': 'ff6347',\n    'turquoise': '40e0d0',\n    'violet': 'ee82ee',\n    'wheat': 'f5deb3',\n    'white': 'fff',\n    'whitesmoke': 'f5f5f5',\n    'yellow': 'ff0',\n    'yellowgreen': '9acd32'\n};\n\nvar HEX_TO_NAME = {\n    '800000': 'maroon',\n    '800080': 'purple',\n    '808000': 'olive',\n    '808080': 'gray',\n    '00ffff': 'cyan',\n    'f0ffff': 'azure',\n    'f5f5dc': 'beige',\n    'ffe4c4': 'bisque',\n    '000000': 'black',\n    '0000ff': 'blue',\n    'a52a2a': 'brown',\n    'ff7f50': 'coral',\n    'ffd700': 'gold',\n    '008000': 'green',\n    '4b0082': 'indigo',\n    'fffff0': 'ivory',\n    'f0e68c': 'khaki',\n    '00ff00': 'lime',\n    'faf0e6': 'linen',\n    '000080': 'navy',\n    'ffa500': 'orange',\n    'da70d6': 'orchid',\n    'cd853f': 'peru',\n    'ffc0cb': 'pink',\n    'dda0dd': 'plum',\n    'f00': 'red',\n    'ff0000': 'red',\n    'fa8072': 'salmon',\n    'a0522d': 'sienna',\n    'c0c0c0': 'silver',\n    'fffafa': 'snow',\n    'd2b48c': 'tan',\n    '008080': 'teal',\n    'ff6347': 'tomato',\n    'ee82ee': 'violet',\n    'f5deb3': 'wheat',\n    'ffffff': 'white',\n    'ffff00': 'yellow'\n};\n\nfunction hueToRgb(p, q, t) {\n    if (t < 0) {\n        t += 1;\n    }\n    if (t > 1) {\n        t -= 1;\n    }\n    if (t < 1 / 6) {\n        return p + (q - p) * 6 * t;\n    }\n    if (t < 1 / 2) {\n        return q;\n    }\n    if (t < 2 / 3) {\n        return p + (q - p) * (2 / 3 - t) * 6;\n    }\n    return p;\n}\n\nfunction hslToRgb(h, s, l, a) {\n    var r;\n    var g;\n    var b;\n\n    if (s === 0) {\n        r = g = b = l; // achromatic\n    } else {\n        var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n        var p = 2 * l - q;\n\n        r = hueToRgb(p, q, h + 1 / 3);\n        g = hueToRgb(p, q, h);\n        b = hueToRgb(p, q, h - 1 / 3);\n    }\n\n    return [\n        Math.round(r * 255),\n        Math.round(g * 255),\n        Math.round(b * 255),\n        a\n    ];\n}\n\nfunction toHex(value) {\n    value = value.toString(16);\n    return value.length === 1 ? '0' + value : value;\n}\n\nfunction parseFunctionArgs(functionArgs, count, rgb) {\n    var cursor = functionArgs.head;\n    var args = [];\n    var wasValue = false;\n\n    while (cursor !== null) {\n        var node = cursor.data;\n        var type = node.type;\n\n        switch (type) {\n            case 'Number':\n            case 'Percentage':\n                if (wasValue) {\n                    return;\n                }\n\n                wasValue = true;\n                args.push({\n                    type: type,\n                    value: Number(node.value)\n                });\n                break;\n\n            case 'Operator':\n                if (node.value === ',') {\n                    if (!wasValue) {\n                        return;\n                    }\n                    wasValue = false;\n                } else if (wasValue || node.value !== '+') {\n                    return;\n                }\n                break;\n\n            default:\n                // something we couldn't understand\n                return;\n        }\n\n        cursor = cursor.next;\n    }\n\n    if (args.length !== count) {\n        // invalid arguments count\n        // TODO: remove those tokens\n        return;\n    }\n\n    if (args.length === 4) {\n        if (args[3].type !== 'Number') {\n            // 4th argument should be a number\n            // TODO: remove those tokens\n            return;\n        }\n\n        args[3].type = 'Alpha';\n    }\n\n    if (rgb) {\n        if (args[0].type !== args[1].type || args[0].type !== args[2].type) {\n            // invalid color, numbers and percentage shouldn't be mixed\n            // TODO: remove those tokens\n            return;\n        }\n    } else {\n        if (args[0].type !== 'Number' ||\n            args[1].type !== 'Percentage' ||\n            args[2].type !== 'Percentage') {\n            // invalid color, for hsl values should be: number, percentage, percentage\n            // TODO: remove those tokens\n            return;\n        }\n\n        args[0].type = 'Angle';\n    }\n\n    return args.map(function(arg) {\n        var value = Math.max(0, arg.value);\n\n        switch (arg.type) {\n            case 'Number':\n                // fit value to [0..255] range\n                value = Math.min(value, 255);\n                break;\n\n            case 'Percentage':\n                // convert 0..100% to value in [0..255] range\n                value = Math.min(value, 100) / 100;\n\n                if (!rgb) {\n                    return value;\n                }\n\n                value = 255 * value;\n                break;\n\n            case 'Angle':\n                // fit value to (-360..360) range\n                return (((value % 360) + 360) % 360) / 360;\n\n            case 'Alpha':\n                // fit value to [0..1] range\n                return Math.min(value, 1);\n        }\n\n        return Math.round(value);\n    });\n}\n\nfunction compressFunction(node, item, list) {\n    var functionName = node.name;\n    var args;\n\n    if (functionName === 'rgba' || functionName === 'hsla') {\n        args = parseFunctionArgs(node.children, 4, functionName === 'rgba');\n\n        if (!args) {\n            // something went wrong\n            return;\n        }\n\n        if (functionName === 'hsla') {\n            args = hslToRgb.apply(null, args);\n            node.name = 'rgba';\n        }\n\n        if (args[3] !== 1) {\n            // replace argument values for normalized/interpolated\n            node.children.each(function(node, item, list) {\n                if (node.type === 'Operator') {\n                    if (node.value !== ',') {\n                        list.remove(item);\n                    }\n                    return;\n                }\n\n                item.data = {\n                    type: 'Number',\n                    loc: node.loc,\n                    value: packNumber(args.shift())\n                };\n            });\n\n            return;\n        }\n\n        // otherwise convert to rgb, i.e. rgba(255, 0, 0, 1) -> rgb(255, 0, 0)\n        functionName = 'rgb';\n    }\n\n    if (functionName === 'hsl') {\n        args = args || parseFunctionArgs(node.children, 3, false);\n\n        if (!args) {\n            // something went wrong\n            return;\n        }\n\n        // convert to rgb\n        args = hslToRgb.apply(null, args);\n        functionName = 'rgb';\n    }\n\n    if (functionName === 'rgb') {\n        args = args || parseFunctionArgs(node.children, 3, true);\n\n        if (!args) {\n            // something went wrong\n            return;\n        }\n\n        // check if color is not at the end and not followed by space\n        var next = item.next;\n        if (next && next.data.type !== 'WhiteSpace') {\n            list.insert(list.createItem({\n                type: 'WhiteSpace',\n                value: ' '\n            }), next);\n        }\n\n        item.data = {\n            type: 'HexColor',\n            loc: node.loc,\n            value: toHex(args[0]) + toHex(args[1]) + toHex(args[2])\n        };\n\n        compressHex(item.data, item);\n    }\n}\n\nfunction compressIdent(node, item) {\n    if (this.declaration === null) {\n        return;\n    }\n\n    var color = node.name.toLowerCase();\n\n    if (NAME_TO_HEX.hasOwnProperty(color)) {\n        var hex = NAME_TO_HEX[color];\n\n        if (hex.length + 1 <= color.length) {\n            // replace for shorter hex value\n            item.data = {\n                type: 'HexColor',\n                loc: node.loc,\n                value: hex\n            };\n        } else {\n            // special case for consistent colors\n            if (color === 'grey') {\n                color = 'gray';\n            }\n\n            // just replace value for lower cased name\n            node.name = color;\n        }\n    }\n}\n\nfunction compressHex(node, item) {\n    var color = node.value.toLowerCase();\n\n    // #112233 -> #123\n    if (color.length === 6 &&\n        color[0] === color[1] &&\n        color[2] === color[3] &&\n        color[4] === color[5]) {\n        color = color[0] + color[2] + color[4];\n    }\n\n    if (HEX_TO_NAME[color]) {\n        item.data = {\n            type: 'Identifier',\n            loc: node.loc,\n            name: HEX_TO_NAME[color]\n        };\n    } else {\n        node.value = color;\n    }\n}\n\nmodule.exports = {\n    compressFunction: compressFunction,\n    compressIdent: compressIdent,\n    compressHex: compressHex\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/restructure/index.js":"var prepare = require('./prepare/index.js');\nvar initialMergeRuleset = require('./1-initialMergeRuleset.js');\nvar mergeAtrule = require('./2-mergeAtrule.js');\nvar disjoinRuleset = require('./3-disjoinRuleset.js');\nvar restructShorthand = require('./4-restructShorthand.js');\nvar restructBlock = require('./6-restructBlock.js');\nvar mergeRuleset = require('./7-mergeRuleset.js');\nvar restructRuleset = require('./8-restructRuleset.js');\n\nmodule.exports = function(ast, usageData, debug) {\n    // prepare ast for restructing\n    var indexer = prepare(ast, usageData);\n    debug('prepare', ast);\n\n    initialMergeRuleset(ast);\n    debug('initialMergeRuleset', ast);\n\n    mergeAtrule(ast);\n    debug('mergeAtrule', ast);\n\n    disjoinRuleset(ast);\n    debug('disjoinRuleset', ast);\n\n    restructShorthand(ast, indexer);\n    debug('restructShorthand', ast);\n\n    restructBlock(ast);\n    debug('restructBlock', ast);\n\n    mergeRuleset(ast);\n    debug('mergeRuleset', ast);\n\n    restructRuleset(ast);\n    debug('restructRuleset', ast);\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/restructure/prepare/index.js":"var resolveKeyword = require('css-tree').keyword;\nvar walkRules = require('css-tree').walkRules;\nvar translate = require('css-tree').translate;\nvar createDeclarationIndexer = require('./createDeclarationIndexer.js');\nvar processSelector = require('./processSelector.js');\n\nfunction walk(node, markDeclaration, usageData) {\n    switch (node.type) {\n        case 'Rule':\n            node.block.children.each(markDeclaration);\n            processSelector(node, usageData);\n            break;\n\n        case 'Atrule':\n            if (node.expression) {\n                node.expression.id = null; // pre-init property to avoid multiple hidden class for translate\n                node.expression.id = translate(node.expression);\n            }\n\n            // compare keyframe selectors by its values\n            // NOTE: still no clarification about problems with keyframes selector grouping (issue #197)\n            if (resolveKeyword(node.name).name === 'keyframes') {\n                node.block.avoidRulesMerge = true;  /* probably we don't need to prevent those merges for @keyframes\n                                                       TODO: need to be checked */\n                node.block.children.each(function(rule) {\n                    rule.selector.children.each(function(simpleselector) {\n                        simpleselector.compareMarker = simpleselector.id;\n                    });\n                });\n            }\n            break;\n    }\n};\n\nmodule.exports = function prepare(ast, usageData) {\n    var markDeclaration = createDeclarationIndexer();\n\n    walkRules(ast, function(node) {\n        walk(node, markDeclaration, usageData);\n    });\n\n    return {\n        declaration: markDeclaration\n    };\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/restructure/prepare/createDeclarationIndexer.js":"var translate = require('css-tree').translate;\n\nfunction Index() {\n    this.seed = 0;\n    this.map = Object.create(null);\n}\n\nIndex.prototype.resolve = function(str) {\n    var index = this.map[str];\n\n    if (!index) {\n        index = ++this.seed;\n        this.map[str] = index;\n    }\n\n    return index;\n};\n\nmodule.exports = function createDeclarationIndexer() {\n    var ids = new Index();\n\n    return function markDeclaration(node) {\n        var id = translate(node);\n\n        node.id = ids.resolve(id);\n        node.length = id.length;\n        node.fingerprint = null;\n\n        return node;\n    };\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/restructure/prepare/processSelector.js":"var translate = require('css-tree').translate;\nvar specificity = require('./specificity.js');\n\nvar nonFreezePseudoElements = {\n    'first-letter': true,\n    'first-line': true,\n    'after': true,\n    'before': true\n};\nvar nonFreezePseudoClasses = {\n    'link': true,\n    'visited': true,\n    'hover': true,\n    'active': true,\n    'first-letter': true,\n    'first-line': true,\n    'after': true,\n    'before': true\n};\n\nmodule.exports = function freeze(node, usageData) {\n    var pseudos = Object.create(null);\n    var hasPseudo = false;\n\n    node.selector.children.each(function(simpleSelector) {\n        var tagName = '*';\n        var scope = 0;\n\n        simpleSelector.children.some(function(node) {\n            switch (node.type) {\n                case 'ClassSelector':\n                    if (usageData && usageData.scopes) {\n                        var classScope = usageData.scopes[node.name] || 0;\n\n                        if (scope !== 0 && classScope !== scope) {\n                            throw new Error('Selector can\\'t has classes from different scopes: ' + translate(simpleSelector));\n                        }\n\n                        scope = classScope;\n                    }\n                    break;\n\n                case 'PseudoClassSelector':\n                    var name = node.name.toLowerCase();\n\n                    if (!nonFreezePseudoClasses.hasOwnProperty(name)) {\n                        pseudos[name] = true;\n                        hasPseudo = true;\n                    }\n                    break;\n\n                case 'PseudoElementSelector':\n                    var name = node.name.toLowerCase();\n\n                    if (!nonFreezePseudoElements.hasOwnProperty(name)) {\n                        pseudos[name] = true;\n                        hasPseudo = true;\n                    }\n                    break;\n\n                case 'TypeSelector':\n                    tagName = node.name.toLowerCase();\n                    break;\n\n                case 'AttributeSelector':\n                    if (node.flags) {\n                        pseudos['[' + node.flags.toLowerCase() + ']'] = true;\n                        hasPseudo = true;\n                    }\n                    break;\n\n                case 'WhiteSpace':\n                case 'Combinator':\n                    tagName = '*';\n                    break;\n            }\n        });\n\n        simpleSelector.compareMarker = specificity(simpleSelector).toString();\n        simpleSelector.id = null; // pre-init property to avoid multiple hidden class\n        simpleSelector.id = translate(simpleSelector);\n\n        if (scope) {\n            simpleSelector.compareMarker += ':' + scope;\n        }\n\n        if (tagName !== '*') {\n            simpleSelector.compareMarker += ',' + tagName;\n        }\n    });\n\n    // add property to all rule nodes to avoid multiple hidden class\n    node.pseudoSignature = hasPseudo && Object.keys(pseudos).sort().join(',');\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/restructure/prepare/specificity.js":"module.exports = function specificity(simpleSelector) {\n    var A = 0;\n    var B = 0;\n    var C = 0;\n\n    simpleSelector.children.each(function walk(node) {\n        switch (node.type) {\n            case 'SelectorList':\n            case 'Selector':\n                node.children.each(walk);\n                break;\n\n            case 'IdSelector':\n                A++;\n                break;\n\n            case 'ClassSelector':\n            case 'AttributeSelector':\n                B++;\n                break;\n\n            case 'PseudoClassSelector':\n                switch (node.name.toLowerCase()) {\n                    case 'not':\n                        node.children.each(walk);\n                        break;\n\n                    case 'before':\n                    case 'after':\n                    case 'first-line':\n                    case 'first-letter':\n                        C++;\n                        break;\n\n                    // TODO: support for :nth-*(.. of <SelectorList>), :matches(), :has()\n\n                    default:\n                        B++;\n                }\n                break;\n\n            case 'PseudoElementSelector':\n                C++;\n                break;\n\n            case 'TypeSelector':\n                // ignore universal selector\n                if (node.name.charAt(node.name.length - 1) !== '*') {\n                    C++;\n                }\n                break;\n\n        }\n    });\n\n    return [A, B, C];\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/restructure/1-initialMergeRuleset.js":"var walkRules = require('css-tree').walkRules;\nvar utils = require('./utils.js');\n\nfunction processRule(node, item, list) {\n    var selectors = node.selector.children;\n    var declarations = node.block.children;\n\n    list.prevUntil(item.prev, function(prev) {\n        // skip non-ruleset node if safe\n        if (prev.type !== 'Rule') {\n            return utils.unsafeToSkipNode.call(selectors, prev);\n        }\n\n        var prevSelectors = prev.selector.children;\n        var prevDeclarations = prev.block.children;\n\n        // try to join rulesets with equal pseudo signature\n        if (node.pseudoSignature === prev.pseudoSignature) {\n            // try to join by selectors\n            if (utils.isEqualSelectors(prevSelectors, selectors)) {\n                prevDeclarations.appendList(declarations);\n                list.remove(item);\n                return true;\n            }\n\n            // try to join by declarations\n            if (utils.isEqualDeclarations(declarations, prevDeclarations)) {\n                utils.addSelectors(prevSelectors, selectors);\n                list.remove(item);\n                return true;\n            }\n        }\n\n        // go to prev ruleset if has no selector similarities\n        return utils.hasSimilarSelectors(selectors, prevSelectors);\n    });\n}\n\n// NOTE: direction should be left to right, since rulesets merge to left\n// ruleset. When direction right to left unmerged rulesets may prevent lookup\n// TODO: remove initial merge\nmodule.exports = function initialMergeRule(ast) {\n    walkRules(ast, function(node, item, list) {\n        if (node.type === 'Rule') {\n            processRule(node, item, list);\n        }\n    });\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/restructure/utils.js":"var hasOwnProperty = Object.prototype.hasOwnProperty;\n\nfunction isEqualSelectors(a, b) {\n    var cursor1 = a.head;\n    var cursor2 = b.head;\n\n    while (cursor1 !== null && cursor2 !== null && cursor1.data.id === cursor2.data.id) {\n        cursor1 = cursor1.next;\n        cursor2 = cursor2.next;\n    }\n\n    return cursor1 === null && cursor2 === null;\n}\n\nfunction isEqualDeclarations(a, b) {\n    var cursor1 = a.head;\n    var cursor2 = b.head;\n\n    while (cursor1 !== null && cursor2 !== null && cursor1.data.id === cursor2.data.id) {\n        cursor1 = cursor1.next;\n        cursor2 = cursor2.next;\n    }\n\n    return cursor1 === null && cursor2 === null;\n}\n\nfunction compareDeclarations(declarations1, declarations2) {\n    var result = {\n        eq: [],\n        ne1: [],\n        ne2: [],\n        ne2overrided: []\n    };\n\n    var fingerprints = Object.create(null);\n    var declarations2hash = Object.create(null);\n\n    for (var cursor = declarations2.head; cursor; cursor = cursor.next)  {\n        declarations2hash[cursor.data.id] = true;\n    }\n\n    for (var cursor = declarations1.head; cursor; cursor = cursor.next)  {\n        var data = cursor.data;\n\n        if (data.fingerprint) {\n            fingerprints[data.fingerprint] = data.important;\n        }\n\n        if (declarations2hash[data.id]) {\n            declarations2hash[data.id] = false;\n            result.eq.push(data);\n        } else {\n            result.ne1.push(data);\n        }\n    }\n\n    for (var cursor = declarations2.head; cursor; cursor = cursor.next)  {\n        var data = cursor.data;\n\n        if (declarations2hash[data.id]) {\n            // if declarations1 has overriding declaration, this is not a difference\n            // but take in account !important - prev should be equal or greater than follow\n            if (hasOwnProperty.call(fingerprints, data.fingerprint) &&\n                Number(fingerprints[data.fingerprint]) >= Number(data.important)) {\n                result.ne2overrided.push(data);\n            } else {\n                result.ne2.push(data);\n            }\n        }\n    }\n\n    return result;\n}\n\nfunction addSelectors(dest, source) {\n    source.each(function(sourceData) {\n        var newStr = sourceData.id;\n        var cursor = dest.head;\n\n        while (cursor) {\n            var nextStr = cursor.data.id;\n\n            if (nextStr === newStr) {\n                return;\n            }\n\n            if (nextStr > newStr) {\n                break;\n            }\n\n            cursor = cursor.next;\n        }\n\n        dest.insert(dest.createItem(sourceData), cursor);\n    });\n\n    return dest;\n}\n\n// check if simpleselectors has no equal specificity and element selector\nfunction hasSimilarSelectors(selectors1, selectors2) {\n    return selectors1.some(function(a) {\n        return selectors2.some(function(b) {\n            return a.compareMarker === b.compareMarker;\n        });\n    });\n}\n\n// test node can't to be skipped\nfunction unsafeToSkipNode(node) {\n    switch (node.type) {\n        case 'Rule':\n            // unsafe skip ruleset with selector similarities\n            return hasSimilarSelectors(node.selector.children, this);\n\n        case 'Atrule':\n            // can skip at-rules with blocks\n            if (node.block) {\n                // unsafe skip at-rule if block contains something unsafe to skip\n                return node.block.children.some(unsafeToSkipNode, this);\n            }\n            break;\n\n        case 'Declaration':\n            return false;\n    }\n\n    // unsafe by default\n    return true;\n}\n\nmodule.exports = {\n    isEqualSelectors: isEqualSelectors,\n    isEqualDeclarations: isEqualDeclarations,\n    compareDeclarations: compareDeclarations,\n    addSelectors: addSelectors,\n    hasSimilarSelectors: hasSimilarSelectors,\n    unsafeToSkipNode: unsafeToSkipNode\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/restructure/2-mergeAtrule.js":"var walkRulesRight = require('css-tree').walkRulesRight;\n\nfunction isMediaRule(node) {\n    return node.type === 'Atrule' && node.name === 'media';\n}\n\nfunction processAtrule(node, item, list) {\n    if (!isMediaRule(node)) {\n        return;\n    }\n\n    var prev = item.prev && item.prev.data;\n\n    if (!prev || !isMediaRule(prev)) {\n        return;\n    }\n\n    // merge @media with same query\n    if (node.expression &&\n        prev.expression &&\n        node.expression.id === prev.expression.id) {\n        prev.block.children.appendList(node.block.children);\n        list.remove(item);\n\n        // TODO: use it when we can refer to several points in source\n        // prev.loc = {\n        //     primary: prev.loc,\n        //     merged: node.loc\n        // };\n    }\n}\n\nmodule.exports = function rejoinAtrule(ast) {\n    walkRulesRight(ast, function(node, item, list) {\n        if (node.type === 'Atrule') {\n            processAtrule(node, item, list);\n        }\n    });\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/restructure/3-disjoinRuleset.js":"var List = require('css-tree').List;\nvar walkRulesRight = require('css-tree').walkRulesRight;\n\nfunction processRule(node, item, list) {\n    var selectors = node.selector.children;\n\n    // generate new rule sets:\n    // .a, .b { color: red; }\n    // ->\n    // .a { color: red; }\n    // .b { color: red; }\n\n    // while there are more than 1 simple selector split for rulesets\n    while (selectors.head !== selectors.tail) {\n        var newSelectors = new List();\n        newSelectors.insert(selectors.remove(selectors.head));\n\n        list.insert(list.createItem({\n            type: 'Rule',\n            loc: node.loc,\n            selector: {\n                type: 'SelectorList',\n                loc: node.selector.loc,\n                children: newSelectors\n            },\n            block: {\n                type: 'Block',\n                loc: node.block.loc,\n                children: node.block.children.copy()\n            },\n            pseudoSignature: node.pseudoSignature\n        }), item);\n    }\n}\n\nmodule.exports = function disjoinRule(ast) {\n    walkRulesRight(ast, function(node, item, list) {\n        if (node.type === 'Rule') {\n            processRule(node, item, list);\n        }\n    });\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/restructure/4-restructShorthand.js":"var List = require('css-tree').List;\nvar translate = require('css-tree').translate;\nvar walkRulesRight = require('css-tree').walkRulesRight;\n\nvar REPLACE = 1;\nvar REMOVE = 2;\nvar TOP = 0;\nvar RIGHT = 1;\nvar BOTTOM = 2;\nvar LEFT = 3;\nvar SIDES = ['top', 'right', 'bottom', 'left'];\nvar SIDE = {\n    'margin-top': 'top',\n    'margin-right': 'right',\n    'margin-bottom': 'bottom',\n    'margin-left': 'left',\n\n    'padding-top': 'top',\n    'padding-right': 'right',\n    'padding-bottom': 'bottom',\n    'padding-left': 'left',\n\n    'border-top-color': 'top',\n    'border-right-color': 'right',\n    'border-bottom-color': 'bottom',\n    'border-left-color': 'left',\n    'border-top-width': 'top',\n    'border-right-width': 'right',\n    'border-bottom-width': 'bottom',\n    'border-left-width': 'left',\n    'border-top-style': 'top',\n    'border-right-style': 'right',\n    'border-bottom-style': 'bottom',\n    'border-left-style': 'left'\n};\nvar MAIN_PROPERTY = {\n    'margin': 'margin',\n    'margin-top': 'margin',\n    'margin-right': 'margin',\n    'margin-bottom': 'margin',\n    'margin-left': 'margin',\n\n    'padding': 'padding',\n    'padding-top': 'padding',\n    'padding-right': 'padding',\n    'padding-bottom': 'padding',\n    'padding-left': 'padding',\n\n    'border-color': 'border-color',\n    'border-top-color': 'border-color',\n    'border-right-color': 'border-color',\n    'border-bottom-color': 'border-color',\n    'border-left-color': 'border-color',\n    'border-width': 'border-width',\n    'border-top-width': 'border-width',\n    'border-right-width': 'border-width',\n    'border-bottom-width': 'border-width',\n    'border-left-width': 'border-width',\n    'border-style': 'border-style',\n    'border-top-style': 'border-style',\n    'border-right-style': 'border-style',\n    'border-bottom-style': 'border-style',\n    'border-left-style': 'border-style'\n};\n\nfunction TRBL(name) {\n    this.name = name;\n    this.loc = null;\n    this.iehack = undefined;\n    this.sides = {\n        'top': null,\n        'right': null,\n        'bottom': null,\n        'left': null\n    };\n}\n\nTRBL.prototype.getValueSequence = function(declaration, count) {\n    var values = [];\n    var iehack = '';\n    var hasBadValues = declaration.value.children.some(function(child) {\n        var special = false;\n\n        switch (child.type) {\n            case 'Identifier':\n                switch (child.name) {\n                    case '\\\\0':\n                    case '\\\\9':\n                        iehack = child.name;\n                        return;\n\n                    case 'inherit':\n                    case 'initial':\n                    case 'unset':\n                    case 'revert':\n                        special = child.name;\n                        break;\n                }\n                break;\n\n            case 'Dimension':\n                switch (child.unit) {\n                    // is not supported until IE11\n                    case 'rem':\n\n                    // v* units is too buggy across browsers and better\n                    // don't merge values with those units\n                    case 'vw':\n                    case 'vh':\n                    case 'vmin':\n                    case 'vmax':\n                    case 'vm': // IE9 supporting \"vm\" instead of \"vmin\".\n                        special = child.unit;\n                        break;\n                }\n                break;\n\n            case 'HexColor': // color\n            case 'Number':\n            case 'Percentage':\n                break;\n\n            case 'Function':\n                special = child.name;\n                break;\n\n            case 'WhiteSpace':\n                return false; // ignore space\n\n            default:\n                return true;  // bad value\n        }\n\n        values.push({\n            node: child,\n            special: special,\n            important: declaration.important\n        });\n    });\n\n    if (hasBadValues || values.length > count) {\n        return false;\n    }\n\n    if (typeof this.iehack === 'string' && this.iehack !== iehack) {\n        return false;\n    }\n\n    this.iehack = iehack; // move outside\n\n    return values;\n};\n\nTRBL.prototype.canOverride = function(side, value) {\n    var currentValue = this.sides[side];\n\n    return !currentValue || (value.important && !currentValue.important);\n};\n\nTRBL.prototype.add = function(name, declaration) {\n    function attemptToAdd() {\n        var sides = this.sides;\n        var side = SIDE[name];\n\n        if (side) {\n            if (side in sides === false) {\n                return false;\n            }\n\n            var values = this.getValueSequence(declaration, 1);\n\n            if (!values || !values.length) {\n                return false;\n            }\n\n            // can mix only if specials are equal\n            for (var key in sides) {\n                if (sides[key] !== null && sides[key].special !== values[0].special) {\n                    return false;\n                }\n            }\n\n            if (!this.canOverride(side, values[0])) {\n                return true;\n            }\n\n            sides[side] = values[0];\n            return true;\n        } else if (name === this.name) {\n            var values = this.getValueSequence(declaration, 4);\n\n            if (!values || !values.length) {\n                return false;\n            }\n\n            switch (values.length) {\n                case 1:\n                    values[RIGHT] = values[TOP];\n                    values[BOTTOM] = values[TOP];\n                    values[LEFT] = values[TOP];\n                    break;\n\n                case 2:\n                    values[BOTTOM] = values[TOP];\n                    values[LEFT] = values[RIGHT];\n                    break;\n\n                case 3:\n                    values[LEFT] = values[RIGHT];\n                    break;\n            }\n\n            // can mix only if specials are equal\n            for (var i = 0; i < 4; i++) {\n                for (var key in sides) {\n                    if (sides[key] !== null && sides[key].special !== values[i].special) {\n                        return false;\n                    }\n                }\n            }\n\n            for (var i = 0; i < 4; i++) {\n                if (this.canOverride(SIDES[i], values[i])) {\n                    sides[SIDES[i]] = values[i];\n                }\n            }\n\n            return true;\n        }\n    }\n\n    if (!attemptToAdd.call(this)) {\n        return false;\n    }\n\n    // TODO: use it when we can refer to several points in source\n    // if (this.loc) {\n    //     this.loc = {\n    //         primary: this.loc,\n    //         merged: declaration.loc\n    //     };\n    // } else {\n    //     this.loc = declaration.loc;\n    // }\n    if (!this.loc) {\n        this.loc = declaration.loc;\n    }\n\n    return true;\n};\n\nTRBL.prototype.isOkToMinimize = function() {\n    var top = this.sides.top;\n    var right = this.sides.right;\n    var bottom = this.sides.bottom;\n    var left = this.sides.left;\n\n    if (top && right && bottom && left) {\n        var important =\n            top.important +\n            right.important +\n            bottom.important +\n            left.important;\n\n        return important === 0 || important === 4;\n    }\n\n    return false;\n};\n\nTRBL.prototype.getValue = function() {\n    var result = new List();\n    var sides = this.sides;\n    var values = [\n        sides.top,\n        sides.right,\n        sides.bottom,\n        sides.left\n    ];\n    var stringValues = [\n        translate(sides.top.node),\n        translate(sides.right.node),\n        translate(sides.bottom.node),\n        translate(sides.left.node)\n    ];\n\n    if (stringValues[LEFT] === stringValues[RIGHT]) {\n        values.pop();\n        if (stringValues[BOTTOM] === stringValues[TOP]) {\n            values.pop();\n            if (stringValues[RIGHT] === stringValues[TOP]) {\n                values.pop();\n            }\n        }\n    }\n\n    for (var i = 0; i < values.length; i++) {\n        if (i) {\n            result.appendData({ type: 'WhiteSpace', value: ' ' });\n        }\n\n        result.appendData(values[i].node);\n    }\n\n    if (this.iehack) {\n        result.appendData({ type: 'WhiteSpace', value: ' ' });\n        result.appendData({\n            type: 'Identifier',\n            loc: null,\n            name: this.iehack\n        });\n    }\n\n    return {\n        type: 'Value',\n        loc: null,\n        children: result\n    };\n};\n\nTRBL.prototype.getDeclaration = function() {\n    return {\n        type: 'Declaration',\n        loc: this.loc,\n        important: this.sides.top.important,\n        property: this.name,\n        value: this.getValue()\n    };\n};\n\nfunction processRule(rule, shorts, shortDeclarations, lastShortSelector) {\n    var declarations = rule.block.children;\n    var selector = rule.selector.children.first().id;\n\n    rule.block.children.eachRight(function(declaration, item) {\n        var property = declaration.property;\n\n        if (!MAIN_PROPERTY.hasOwnProperty(property)) {\n            return;\n        }\n\n        var key = MAIN_PROPERTY[property];\n        var shorthand;\n        var operation;\n\n        if (!lastShortSelector || selector === lastShortSelector) {\n            if (key in shorts) {\n                operation = REMOVE;\n                shorthand = shorts[key];\n            }\n        }\n\n        if (!shorthand || !shorthand.add(property, declaration)) {\n            operation = REPLACE;\n            shorthand = new TRBL(key);\n\n            // if can't parse value ignore it and break shorthand children\n            if (!shorthand.add(property, declaration)) {\n                lastShortSelector = null;\n                return;\n            }\n        }\n\n        shorts[key] = shorthand;\n        shortDeclarations.push({\n            operation: operation,\n            block: declarations,\n            item: item,\n            shorthand: shorthand\n        });\n\n        lastShortSelector = selector;\n    });\n\n    return lastShortSelector;\n}\n\nfunction processShorthands(shortDeclarations, markDeclaration) {\n    shortDeclarations.forEach(function(item) {\n        var shorthand = item.shorthand;\n\n        if (!shorthand.isOkToMinimize()) {\n            return;\n        }\n\n        if (item.operation === REPLACE) {\n            item.item.data = markDeclaration(shorthand.getDeclaration());\n        } else {\n            item.block.remove(item.item);\n        }\n    });\n}\n\nmodule.exports = function restructBlock(ast, indexer) {\n    var stylesheetMap = {};\n    var shortDeclarations = [];\n\n    walkRulesRight(ast, function(node) {\n        if (node.type !== 'Rule') {\n            return;\n        }\n\n        var stylesheet = this.block || this.stylesheet;\n        var ruleId = (node.pseudoSignature || '') + '|' + node.selector.children.first().id;\n        var ruleMap;\n        var shorts;\n\n        if (!stylesheetMap.hasOwnProperty(stylesheet.id)) {\n            ruleMap = {\n                lastShortSelector: null\n            };\n            stylesheetMap[stylesheet.id] = ruleMap;\n        } else {\n            ruleMap = stylesheetMap[stylesheet.id];\n        }\n\n        if (ruleMap.hasOwnProperty(ruleId)) {\n            shorts = ruleMap[ruleId];\n        } else {\n            shorts = {};\n            ruleMap[ruleId] = shorts;\n        }\n\n        ruleMap.lastShortSelector = processRule.call(this, node, shorts, shortDeclarations, ruleMap.lastShortSelector);\n    });\n\n    processShorthands(shortDeclarations, indexer.declaration);\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/restructure/6-restructBlock.js":"var resolveProperty = require('css-tree').property;\nvar resolveKeyword = require('css-tree').keyword;\nvar walkRulesRight = require('css-tree').walkRulesRight;\nvar translate = require('css-tree').translate;\nvar fingerprintId = 1;\nvar dontRestructure = {\n    'src': 1 // https://github.com/afelix/csso/issues/50\n};\n\nvar DONT_MIX_VALUE = {\n    // https://developer.mozilla.org/en-US/docs/Web/CSS/display#Browser_compatibility\n    'display': /table|ruby|flex|-(flex)?box$|grid|contents|run-in/i,\n    // https://developer.mozilla.org/en/docs/Web/CSS/text-align\n    'text-align': /^(start|end|match-parent|justify-all)$/i\n};\n\nvar CURSOR_SAFE_VALUE = [\n    'auto', 'crosshair', 'default', 'move', 'text', 'wait', 'help',\n    'n-resize', 'e-resize', 's-resize', 'w-resize',\n    'ne-resize', 'nw-resize', 'se-resize', 'sw-resize',\n    'pointer', 'progress', 'not-allowed', 'no-drop', 'vertical-text', 'all-scroll',\n    'col-resize', 'row-resize'\n];\n\nvar NEEDLESS_TABLE = {\n    'border-width': ['border'],\n    'border-style': ['border'],\n    'border-color': ['border'],\n    'border-top': ['border'],\n    'border-right': ['border'],\n    'border-bottom': ['border'],\n    'border-left': ['border'],\n    'border-top-width': ['border-top', 'border-width', 'border'],\n    'border-right-width': ['border-right', 'border-width', 'border'],\n    'border-bottom-width': ['border-bottom', 'border-width', 'border'],\n    'border-left-width': ['border-left', 'border-width', 'border'],\n    'border-top-style': ['border-top', 'border-style', 'border'],\n    'border-right-style': ['border-right', 'border-style', 'border'],\n    'border-bottom-style': ['border-bottom', 'border-style', 'border'],\n    'border-left-style': ['border-left', 'border-style', 'border'],\n    'border-top-color': ['border-top', 'border-color', 'border'],\n    'border-right-color': ['border-right', 'border-color', 'border'],\n    'border-bottom-color': ['border-bottom', 'border-color', 'border'],\n    'border-left-color': ['border-left', 'border-color', 'border'],\n    'margin-top': ['margin'],\n    'margin-right': ['margin'],\n    'margin-bottom': ['margin'],\n    'margin-left': ['margin'],\n    'padding-top': ['padding'],\n    'padding-right': ['padding'],\n    'padding-bottom': ['padding'],\n    'padding-left': ['padding'],\n    'font-style': ['font'],\n    'font-variant': ['font'],\n    'font-weight': ['font'],\n    'font-size': ['font'],\n    'font-family': ['font'],\n    'list-style-type': ['list-style'],\n    'list-style-position': ['list-style'],\n    'list-style-image': ['list-style']\n};\n\nfunction getPropertyFingerprint(propertyName, declaration, fingerprints) {\n    var realName = resolveProperty(propertyName).name;\n\n    if (realName === 'background') {\n        return propertyName + ':' + translate(declaration.value);\n    }\n\n    var declarationId = declaration.id;\n    var fingerprint = fingerprints[declarationId];\n\n    if (!fingerprint) {\n        switch (declaration.value.type) {\n            case 'Value':\n                var vendorId = '';\n                var iehack = '';\n                var special = {};\n                var raw = false;\n\n                declaration.value.children.each(function walk(node) {\n                    switch (node.type) {\n                        case 'Value':\n                        case 'Brackets':\n                        case 'Parentheses':\n                            node.children.each(walk);\n                            break;\n\n                        case 'Raw':\n                            raw = true;\n                            break;\n\n                        case 'Identifier':\n                            var name = node.name;\n\n                            if (!vendorId) {\n                                vendorId = resolveKeyword(name).vendor;\n                            }\n\n                            if (/\\\\[09]/.test(name)) {\n                                iehack = RegExp.lastMatch;\n                            }\n\n                            if (realName === 'cursor') {\n                                if (CURSOR_SAFE_VALUE.indexOf(name) === -1) {\n                                    special[name] = true;\n                                }\n                            } else if (DONT_MIX_VALUE.hasOwnProperty(realName)) {\n                                if (DONT_MIX_VALUE[realName].test(name)) {\n                                    special[name] = true;\n                                }\n                            }\n\n                            break;\n\n                        case 'Function':\n                            var name = node.name;\n\n                            if (!vendorId) {\n                                vendorId = resolveKeyword(name).vendor;\n                            }\n\n                            if (name === 'rect') {\n                                // there are 2 forms of rect:\n                                //   rect(<top>, <right>, <bottom>, <left>) - standart\n                                //   rect(<top> <right> <bottom> <left>)  backwards compatible syntax\n                                // only the same form values can be merged\n                                var hasComma = node.children.some(function(node) {\n                                    return node.type === 'Operator' && node.value === ',';\n                                });\n                                if (!hasComma) {\n                                    name = 'rect-backward';\n                                }\n                            }\n\n                            special[name + '()'] = true;\n\n                            // check nested tokens too\n                            node.children.each(walk);\n\n                            break;\n\n                        case 'Dimension':\n                            var unit = node.unit;\n\n                            switch (unit) {\n                                // is not supported until IE11\n                                case 'rem':\n\n                                // v* units is too buggy across browsers and better\n                                // don't merge values with those units\n                                case 'vw':\n                                case 'vh':\n                                case 'vmin':\n                                case 'vmax':\n                                case 'vm': // IE9 supporting \"vm\" instead of \"vmin\".\n                                    special[unit] = true;\n                                    break;\n                            }\n                            break;\n                    }\n                });\n\n                fingerprint = raw\n                    ? '!' + fingerprintId++\n                    : '!' + Object.keys(special).sort() + '|' + iehack + vendorId;\n                break;\n\n            case 'Raw':\n                fingerprint = '!' + declaration.value.value;\n                break;\n\n            default:\n                fingerprint = translate(declaration.value);\n        }\n\n        fingerprints[declarationId] = fingerprint;\n    }\n\n    return propertyName + fingerprint;\n}\n\nfunction needless(props, declaration, fingerprints) {\n    var property = resolveProperty(declaration.property);\n\n    if (NEEDLESS_TABLE.hasOwnProperty(property.name)) {\n        var table = NEEDLESS_TABLE[property.name];\n\n        for (var i = 0; i < table.length; i++) {\n            var ppre = getPropertyFingerprint(property.prefix + table[i], declaration, fingerprints);\n            var prev = props.hasOwnProperty(ppre) ? props[ppre] : null;\n\n            if (prev && (!declaration.important || prev.item.data.important)) {\n                return prev;\n            }\n        }\n    }\n}\n\nfunction processRule(rule, item, list, props, fingerprints) {\n    var declarations = rule.block.children;\n\n    declarations.eachRight(function(declaration, declarationItem) {\n        var property = declaration.property;\n        var fingerprint = getPropertyFingerprint(property, declaration, fingerprints);\n        var prev = props[fingerprint];\n\n        if (prev && !dontRestructure.hasOwnProperty(property)) {\n            if (declaration.important && !prev.item.data.important) {\n                props[fingerprint] = {\n                    block: declarations,\n                    item: declarationItem\n                };\n\n                prev.block.remove(prev.item);\n\n                // TODO: use it when we can refer to several points in source\n                // declaration.loc = {\n                //     primary: declaration.loc,\n                //     merged: prev.item.data.loc\n                // };\n            } else {\n                declarations.remove(declarationItem);\n\n                // TODO: use it when we can refer to several points in source\n                // prev.item.data.loc = {\n                //     primary: prev.item.data.loc,\n                //     merged: declaration.loc\n                // };\n            }\n        } else {\n            var prev = needless(props, declaration, fingerprints);\n\n            if (prev) {\n                declarations.remove(declarationItem);\n\n                // TODO: use it when we can refer to several points in source\n                // prev.item.data.loc = {\n                //     primary: prev.item.data.loc,\n                //     merged: declaration.loc\n                // };\n            } else {\n                declaration.fingerprint = fingerprint;\n\n                props[fingerprint] = {\n                    block: declarations,\n                    item: declarationItem\n                };\n            }\n        }\n    });\n\n    if (declarations.isEmpty()) {\n        list.remove(item);\n    }\n}\n\nmodule.exports = function restructBlock(ast) {\n    var stylesheetMap = {};\n    var fingerprints = Object.create(null);\n\n    walkRulesRight(ast, function(node, item, list) {\n        if (node.type !== 'Rule') {\n            return;\n        }\n\n        var stylesheet = this.block || this.stylesheet;\n        var ruleId = (node.pseudoSignature || '') + '|' + node.selector.children.first().id;\n        var ruleMap;\n        var props;\n\n        if (!stylesheetMap.hasOwnProperty(stylesheet.id)) {\n            ruleMap = {};\n            stylesheetMap[stylesheet.id] = ruleMap;\n        } else {\n            ruleMap = stylesheetMap[stylesheet.id];\n        }\n\n        if (ruleMap.hasOwnProperty(ruleId)) {\n            props = ruleMap[ruleId];\n        } else {\n            props = {};\n            ruleMap[ruleId] = props;\n        }\n\n        processRule.call(this, node, item, list, props, fingerprints);\n    });\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/restructure/7-mergeRuleset.js":"var utils = require('./utils.js');\nvar walkRules = require('css-tree').walkRules;\n\n/*\n    At this step all rules has single simple selector. We try to join by equal\n    declaration blocks to first rule, e.g.\n\n    .a { color: red }\n    b { ... }\n    .b { color: red }\n    ->\n    .a, .b { color: red }\n    b { ... }\n*/\n\nfunction processRule(node, item, list) {\n    var selectors = node.selector.children;\n    var declarations = node.block.children;\n    var nodeCompareMarker = selectors.first().compareMarker;\n    var skippedCompareMarkers = {};\n\n    list.nextUntil(item.next, function(next, nextItem) {\n        // skip non-ruleset node if safe\n        if (next.type !== 'Rule') {\n            return utils.unsafeToSkipNode.call(selectors, next);\n        }\n\n        if (node.pseudoSignature !== next.pseudoSignature) {\n            return true;\n        }\n\n        var nextFirstSelector = next.selector.children.head;\n        var nextDeclarations = next.block.children;\n        var nextCompareMarker = nextFirstSelector.data.compareMarker;\n\n        // if next ruleset has same marked as one of skipped then stop joining\n        if (nextCompareMarker in skippedCompareMarkers) {\n            return true;\n        }\n\n        // try to join by selectors\n        if (selectors.head === selectors.tail) {\n            if (selectors.first().id === nextFirstSelector.data.id) {\n                declarations.appendList(nextDeclarations);\n                list.remove(nextItem);\n                return;\n            }\n        }\n\n        // try to join by properties\n        if (utils.isEqualDeclarations(declarations, nextDeclarations)) {\n            var nextStr = nextFirstSelector.data.id;\n\n            selectors.some(function(data, item) {\n                var curStr = data.id;\n\n                if (nextStr < curStr) {\n                    selectors.insert(nextFirstSelector, item);\n                    return true;\n                }\n\n                if (!item.next) {\n                    selectors.insert(nextFirstSelector);\n                    return true;\n                }\n            });\n\n            list.remove(nextItem);\n            return;\n        }\n\n        // go to next ruleset if current one can be skipped (has no equal specificity nor element selector)\n        if (nextCompareMarker === nodeCompareMarker) {\n            return true;\n        }\n\n        skippedCompareMarkers[nextCompareMarker] = true;\n    });\n}\n\nmodule.exports = function mergeRule(ast) {\n    walkRules(ast, function(node, item, list) {\n        if (node.type === 'Rule') {\n            processRule(node, item, list);\n        }\n    });\n};\n","/home/travis/build/npmtest/node-npmtest-csso/csso/lib/restructure/8-restructRuleset.js":"var List = require('css-tree').List;\nvar walkRulesRight = require('css-tree').walkRulesRight;\nvar utils = require('./utils.js');\n\nfunction calcSelectorLength(list) {\n    var length = 0;\n\n    list.each(function(data) {\n        length += data.id.length + 1;\n    });\n\n    return length - 1;\n}\n\nfunction calcDeclarationsLength(tokens) {\n    var length = 0;\n\n    for (var i = 0; i < tokens.length; i++) {\n        length += tokens[i].length;\n    }\n\n    return (\n        length +          // declarations\n        tokens.length - 1 // delimeters\n    );\n}\n\nfunction processRule(node, item, list) {\n    var avoidRulesMerge = this.block !== null ? this.block.avoidRulesMerge : false;\n    var selectors = node.selector.children;\n    var block = node.block;\n    var disallowDownMarkers = Object.create(null);\n    var allowMergeUp = true;\n    var allowMergeDown = true;\n\n    list.prevUntil(item.prev, function(prev, prevItem) {\n        // skip non-ruleset node if safe\n        if (prev.type !== 'Rule') {\n            return utils.unsafeToSkipNode.call(selectors, prev);\n        }\n\n        var prevSelectors = prev.selector.children;\n        var prevBlock = prev.block;\n\n        if (node.pseudoSignature !== prev.pseudoSignature) {\n            return true;\n        }\n\n        allowMergeDown = !prevSelectors.some(function(selector) {\n            return selector.compareMarker in disallowDownMarkers;\n        });\n\n        // try prev ruleset if simpleselectors has no equal specifity and element selector\n        if (!allowMergeDown && !allowMergeUp) {\n            return true;\n        }\n\n        // try to join by selectors\n        if (allowMergeUp && utils.isEqualSelectors(prevSelectors, selectors)) {\n            prevBlock.children.appendList(block.children);\n            list.remove(item);\n            return true;\n        }\n\n        // try to join by properties\n        var diff = utils.compareDeclarations(block.children, prevBlock.children);\n\n        // console.log(diff.eq, diff.ne1, diff.ne2);\n\n        if (diff.eq.length) {\n            if (!diff.ne1.length && !diff.ne2.length) {\n                // equal blocks\n                if (allowMergeDown) {\n                    utils.addSelectors(selectors, prevSelectors);\n                    list.remove(prevItem);\n                }\n\n                return true;\n            } else if (!avoidRulesMerge) { /* probably we don't need to prevent those merges for @keyframes\n                                              TODO: need to be checked */\n\n                if (diff.ne1.length && !diff.ne2.length) {\n                    // prevBlock is subset block\n                    var selectorLength = calcSelectorLength(selectors);\n                    var blockLength = calcDeclarationsLength(diff.eq); // declarations length\n\n                    if (allowMergeUp && selectorLength < blockLength) {\n                        utils.addSelectors(prevSelectors, selectors);\n                        block.children = new List().fromArray(diff.ne1);\n                    }\n                } else if (!diff.ne1.length && diff.ne2.length) {\n                    // node is subset of prevBlock\n                    var selectorLength = calcSelectorLength(prevSelectors);\n                    var blockLength = calcDeclarationsLength(diff.eq); // declarations length\n\n                    if (allowMergeDown && selectorLength < blockLength) {\n                        utils.addSelectors(selectors, prevSelectors);\n                        prevBlock.children = new List().fromArray(diff.ne2);\n                    }\n                } else {\n                    // diff.ne1.length && diff.ne2.length\n                    // extract equal block\n                    var newSelector = {\n                        type: 'SelectorList',\n                        loc: null,\n                        children: utils.addSelectors(prevSelectors.copy(), selectors)\n                    };\n                    var newBlockLength = calcSelectorLength(newSelector.children) + 2; // selectors length + curly braces length\n                    var blockLength = calcDeclarationsLength(diff.eq); // declarations length\n\n                    // create new ruleset if declarations length greater than\n                    // ruleset description overhead\n                    if (allowMergeDown && blockLength >= newBlockLength) {\n                        var newRule = {\n                            type: 'Rule',\n                            loc: null,\n                            selector: newSelector,\n                            block: {\n                                type: 'Block',\n                                loc: null,\n                                children: new List().fromArray(diff.eq)\n                            },\n                            pseudoSignature: node.pseudoSignature\n                        };\n\n                        block.children = new List().fromArray(diff.ne1);\n                        prevBlock.children = new List().fromArray(diff.ne2.concat(diff.ne2overrided));\n                        list.insert(list.createItem(newRule), prevItem);\n                        return true;\n                    }\n                }\n            }\n        }\n\n        if (allowMergeUp) {\n            // TODO: disallow up merge only if any property interception only (i.e. diff.ne2overrided.length > 0);\n            // await property families to find property interception correctly\n            allowMergeUp = !prevSelectors.some(function(prevSelector) {\n                return selectors.some(function(selector) {\n                    return selector.compareMarker === prevSelector.compareMarker;\n                });\n            });\n        }\n\n        prevSelectors.each(function(data) {\n            disallowDownMarkers[data.compareMarker] = true;\n        });\n    });\n}\n\nmodule.exports = function restructRule(ast) {\n    walkRulesRight(ast, function(node, item, list) {\n        if (node.type === 'Rule') {\n            processRule.call(this, node, item, list);\n        }\n    });\n};\n"}